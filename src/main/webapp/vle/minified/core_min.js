function createProject(a,b,c,d,e){return function(a,b,c,d,e){var m=[],l=[],s,v,t,y,q,E=[],F=5,u=[],Q=function(a){for(var b=e.getContentJSON().nodes,c=0;c<b.length;c++)if(b[c].identifier==a)return b[c].content},R=function(){for(var a=[],b=0;b<m.length;b++)m[b].type=="DuplicateNode"&&a.push(m[b]);for(b=0;b<a.length;b++)a[b].realNode=o(a[b].realNodeId)},S=function(){var z=a.getContentJSON().nodes;z||(z=[]);for(var C=0;C<z.length;C++){var n=z[C],h=NodeFactory.createNode(n,d);if(h==null)d.notificationManager.notify("null was returned from project factory for node: "+
n.identifier+" \nSkipping node.",2);else{!n.identifier||n.identifier==""?d.notificationManager.notify("No identifier for node in project file.",3):(h.id=n.identifier,o(h.id)&&d.notificationManager.notify("Duplicate node id: "+h.id+" found in project",3));if(n.type!="DuplicateNode"){!n.title||n.title==""?d.notificationManager.notify("No title attribute for node with id: "+h.id,2):h.title=n.title;!n["class"]||n["class"]==""?d.notificationManager.notify("No class attribute for node with id: "+h.id,2):
h.className=n["class"];if(n.ContentBaseUrl)h.ContentBaseUrl=n.ContentBaseUrl;!n.ref||n.ref==""?d.notificationManager.notify("No filename specified for node with id: "+h.id+" in the project file",2):h.content=createContent(G(n.ref,h),b);if(n.peerReview&&n.peerReview!="")h.peerReview=n.peerReview;if(n.teacherReview&&n.teacherReview!="")h.teacherReview=n.teacherReview;if(n.reviewGroup&&n.reviewGroup!="")h.reviewGroup=n.reviewGroup;if(n.associatedStartNode&&n.associatedStartNode!="")h.associatedStartNode=
n.associatedStartNode;if(n.associatedAnnotateNode&&n.associatedAnnotateNode!="")h.associatedAnnotateNode=n.associatedAnnotateNode;e&&h.content.setContent(Q(h.id));c||h.content.retrieveContent()}m.push(h);h.prevWorkNodeIds=n.previousWorkNodeIds;if(n.links)h.links=n.links;eventManager.subscribe("pageRenderComplete",h.pageRenderComplete,h);eventManager.subscribe("contentRenderComplete",h.contentRenderComplete,h);eventManager.subscribe("scriptsLoaded",h.loadContentAfterScriptsLoad,h)}}},T=function(){var b=
a.getContentJSON(),c=b.sequences;c||(c=[]);for(var n=0;n<c.length;n++){var h=NodeFactory.createNode(c[n],d);if(h)h.json=c[n],o(h.id)&&d.notificationManager.notify("Duplicate sequence id: "+h.id+" found in project.",3);l.push(h)}if(b.startPoint)var e=o(b.startPoint);else d.notificationManager.notify("No starting sequence specified for this project",3);if(e){for(b=0;b<l.length;b++)if(A(l[b].id,[],"file"))for(var c=l[b].id,n=o(c),h=n.json.refs,k=0;k<h.length;k++){var g=o(h[k]);g?n.addChildNode(g):d.notificationManager.notify("Node reference "+
h[k]+" exists in sequence node "+c+" but the node has not been defined and does not exist.",2)}else return d.notificationManager.notify("Infinite loop discovered in sequences, check sequence references",3),null;q=e}},o=function(a){for(var b=0;b<m.length;b++)if(m[b].id==a)return m[b];for(b=0;b<l.length;b++)if(l[b]&&l[b].id==a)return l[b];return null},G=function(a,c){var n=b;if(c!==void 0)if(typeof c=="string")n=c;else if(c.ContentBaseUrl)n=c.ContentBaseUrl;return n.lastIndexOf("\\")!=-1?n+"\\"+a:n?
n+"/"+a:a},A=function(a,b,c){if(b.indexOf(a)==-1){var h;var e=o(a);if(e)if(h=[],c=="file"){e=e.json.refs;for(c=0;c<e.length;c++)h.push(e[c])}else{e=e.children;for(c=0;c<e.length;c++)e[c].type=="sequence"&&h.push(e[c].id)}else d.notificationManager.notify("Sequence with id: "+a+" is referenced but this sequence does not exist.",2),h=[];if(h.length>0){b.push(a);for(c=0;c<h.length;c++)if(!A(h[c],b))return!1;b.pop(a)}return!0}else return!1},H=function(a){for(var b=0;b<m.length;b++)if(m[b].title==a)return m[b];
for(b=0;b<l.length;b++)if(l[b].title==a)return l[b];return null},I=function(a){if(a)if(a.type=="sequence")for(var b=0;b<a.children.length;b++){var c=I(a.children[b]);if(c!=null)return c}else return a.id;else d.notificationManager.notify("Cannot get start node! Possibly no start sequence is specified or invalid node exists in project.",2)},J=function(a){for(var b=0;b<l.length;b++)for(var c=0;c<l[b].children.length;c++)l[b].children[c].id==a&&l[b].children.splice(c,1)},K=function(a,b){if(a.type=="sequence")for(var c=
0;c<a.children.length;c++){var d=K(a.children[c],b+"."+c);if(d!=void 0&&d!=null)return d}else return b},L=function(a,b,c){if(a.id==c)return b;else if(a.type=="sequence")for(var d=0;d<a.children.length;d++){var e=L(a.children[d],b+"."+d,c);if(e)return e}},U=function(){for(var a="Sequences defined by Id: ",b=0;b<l.length;b++)l[b]&&(a+=b==l.length-1?" "+l[b].id:" "+l[b].id+",");d.notificationManager.notify(a,1)},V=function(){for(var a="Nodes defined by Id: ",b=0;b<m.length;b++)a+=b==m.length-1?" "+m[b].id:
" "+m[b].id+",";d.notificationManager.notify(a,1)},W=function(){for(var a="Sequence(s) with id(s): ",b=!1,c=0;c<l.length;c++){var h;h=q?q.id:"rootNode";l[c]&&!D(l[c].id)&&l[c].id!=h&&(b=!0,a+=" "+l[c].id)}b&&d.notificationManager.notify(a+" is/are never used in this project",1)},X=function(){for(var a="Node(s) with id(s): ",b=!1,c=0;c<m.length;c++)D(m[c].id)||(b=!0,a+=" "+m[c].id);b&&d.notificationManager.notify(a+" is/are never used in this project",1)},Y=function(){for(var a="Duplicate sequence Id(s) are: ",
b=!1,c=0;c<l.length;c++)if(l[c]){for(var h=0,e=0;e<l.length;e++)l[e]&&l[c].id==l[e].id&&h++;h>1&&(b=!0,a+=l[c].id+" ")}b&&d.notificationManager.notify(a,1)},Z=function(){for(var a="Duplicate node Id(s) are: ",b=!1,c=0;c<m.length;c++){for(var h=0,e=0;e<m.length;e++)m[c].id==m[e].id&&h++;h>1&&(b=!0,a+=m[c].id+" ")}b&&d.notificationManager.notify(a,1)},D=function(a){for(var b=0;b<l.length;b++)if(l[b])for(var c=0;c<l[b].children.length;c++)if(l[b].children[c].id==a)return!0;return!1},N=function(b){var c=
a.getContentJSON().startPoint,d=[],c=o(c);return d=M(d,c,b)},M=function(a,b,c){if(b.type=="sequence")for(var b=b.children,d=0;d<b.length;d++)a=M(a,b[d],c);else d=b.type,(!c||c.indexOf(d)==-1)&&a.push(b.id);return a},aa=function(a,b){var c=d.state.getLastTimeVisited();this.showAllWorkStepCounter=1;this.showAllWorkActivityCounter=0;this.foundNewFeedback=!1;var c=O(a,b,c),h="";c.newFeedback!=""&&(h="<h2 class='showAllWorkH2'>New Feedback</h2><br><hr class='showAllWorkHR'><br>"+c.newFeedback);return h+
("<h2 class='showAllWorkH2'>All Work</h2><br><hr class='showAllWorkHR'><br>"+c.allFeedback)},O=function(a,b,c){var h={newFeedback:"",allFeedback:""};if(a.children.length>0){this.showAllWorkActivityCounter!=0&&(h.allFeedback+="<div class='showAllWorkActivity'><h3>"+this.showAllWorkActivityCounter+". "+a.title+"</h3></div><br><hr class='showAllWorkHR'><br>");this.showAllWorkActivityCounter++;for(var e=0;e<a.children.length;e++){var f=O(a.children[e],b,c);h.newFeedback+=f.newFeedback;h.allFeedback+=
f.allFeedback}}else{if(a.type!="HtmlNode"&&a.type!="OutsideUrlNode"){var f=a.id,k=x(f),g=e="",l="",m=!1;g+='<div id="showallStep"><a href="#" onclick="eventManager.fire(\'renderNode\', [\''+B(a.id)+"']); $('#showallwork').dialog('close');\">"+k+" "+a.title+'</a><div class="type">'+a.getType(!0)+"</div></div>";l+='<div id="showallStep"><a href="#" onclick="eventManager.fire(\'renderNode\', [\''+B(a.id)+"']); $('#showallwork').dialog('close');\">"+k+" "+a.title+'</a><div class="type">'+a.getType(!0)+
"</div></div>";if(b){g+='<div class="showallStatus">Status: '+a.getShowAllWorkHtml(d)+"</div>";l+='<div class="showallStatus">Status: '+a.getShowAllWorkHtml(d,"new_")+"</div>";e+="<div><table id='teacherTable'>";var k=d.getConfig().getConfigParam("runId"),v=d.getUserAndClassInfo().getWorkgroupId(),r=d.getUserAndClassInfo().getAllTeacherWorkgroupIds(),o=b="";a.view.maxScores&&(o=a.view.maxScores.getMaxScoreValueByNodeId(f));o!==""&&(o=" / "+o);var t=d.annotations.getLatestAnnotation(k,f,v,r,"score");
if(t&&t.value!=""){o="<p style='display: inline'>Teacher Score: "+t.value+o+"</p>";a="";if(t.postTime>c)a="<p style='display: inline; color: red;'> [New]</p>",this.foundNewFeedback=m=!0;b+="<tr><td class='teachermsg2'>"+o+a+"</td></tr>"}if((f=d.annotations.getLatestAnnotation(k,f,v,r,"comment"))&&f.value!=""){k="<p style='display: inline'>Teacher Feedback: "+f.value+"</p>";a="";if(f.postTime>c)a="<p style='display: inline; color: red;'> [New]</p>",this.foundNewFeedback=m=!0;b+="<tr><td class='teachermsg1'>"+
k+a+"</td></tr>"}b==""&&(b+="<tr><td class='teachermsg3'>Grading: Your Teacher hasn't graded this step yet.<td></tr>");e+=b;e+="</table></div><br><hr class='showAllWorkHR'><br>"}else f=a.getShowAllWorkHtmlHelper(d),h.newFeedback+=f.newFeedback,h.allFeedback+=f.allFeedback;h.allFeedback+=g+e;m&&(h.newFeedback+=l+e)}this.showAllWorkStepCounter++}return h},B=function(a){for(var b=0;b<q.children.length;b++){var c=L(q.children[b],b,a);if(c!=void 0&&c!=null)return c}return null},ba=function(a,b){for(var c=
0;c<a.length;c++)a[c]=o(a[c]).getNode().id;for(var c=function(a,b,c){a=b[0];b=b[1];c.queue.shift().id!=a&&c.view.notificationManager("Copied node id and node id from queue do match, error when copying.",3);b?(c.msg+=" Copied "+a+" to "+b,c.view.getProject().addCopyId(b),c.copiedIds.push(b)):c.msg+=" Failed copy of "+a;c.queue.length>0?(c=c.queue[0],c.node.copy(c.eventName)):c.view.eventManager.fire(c.eventName,[c.copiedIds,c.msg])},h={view:d,queue:[],eventName:b,msg:"",copiedIds:[]},e=0;e<a.length;e++){var f=
d.eventManager.generateUniqueEventName("copy_");h.queue.push({id:a[e],node:o(a[e]),eventName:f});d.eventManager.addEvent(f);d.eventManager.subscribe(f,c,h)}h.queue.length>0?(c=h.queue[0],c.node.copy(c.eventName)):d.eventManager.fire(b,[null,null])},x=function(a){var b="",a=B(a);if(a!=null)for(var a=a.split("."),c=0;c<a.length;c++){var d=a[c];b!=""&&(b+=".");b+=parseInt(d)+1}return b},P=function(a,b){var c=[],d=o(a);if(d.isSequence())for(var e=0;e<d.children.length;e++)d.children[e].isSequence()?(b&&
c.push(d.children[e].id),c=c.concat(P(d.children[e].id,b))):c.push(d.children[e].id);return c},ca=function(){return this.foundNewFeedback};e&&a.setContent(e.getContentJSON().project);var w=a.getContentJSON();w?(s=w.autoStep,v=w.stepLevelNum,y=w.stepTerm,t=w.title,u=w.constraints?w.constraints:[],S(),T(),R(),U(),V(),W(),X(),Y(),Z()):d.notificationManager.notify("Unable to parse project content, check project.json file. Unable to continue.",5);return{useAutoStep:function(){return s},setAutoStep:function(a){s=
a},useStepLevelNumbering:function(){return v},setStepLevelNumbering:function(a){v=a},getStepTerm:function(){return y},setStepTerm:function(a){y=a},getTitle:function(){return t},setTitle:function(a){t=a},getNodeById:function(a){return o(a)},validateNoLoops:function(a,b,c){return A(a,b,c)},getNodeByTitle:function(a){return H(a)},getNodeByPosition:function(a){var b;a:if(a)for(var a=a.split("."),c=q,d=0;d<a.length;d++)if(c=c.children[a[d]]){if(d==a.length-1){b=c;break a}}else{b=null;break a}else b=null;
return b},getNodeIds:function(a){return N(a)},getShowAllWorkHtml:function(a,b){return aa(a,b)},getStartNodeId:function(){return I(q)},removeNodeById:function(a){a:{for(var b=0;b<l.length;b++)if(l[b].id==a){l.splice(b,1);J(a);break a}for(b=0;b<m.length;b++)if(m[b].id==a){m.splice(b,1);J(a);break a}}},removeReferenceFromSequence:function(a,b){o(a).children.splice(b,1)},addNodeToSequence:function(a,b,c){var a=o(a),e=o(b);e.children.splice(c,0,a);A(b,[])||(d.notificationManager.notify("This would cause an infinite loop! Undoing changes...",
3),e.children.splice(c,1))},copyNodes:function(a,b){ba(a,b)},getStartNodePosition:function(){var a;a:for(var b=0;b<q.children.length;b++){var c=K(q.children[b],b);if(c!=void 0&&c!=null){a=c;break a}}return a},getPositionById:function(a){return B(a)},getContentBase:function(){return b},getProjectFilename:function(){var c=a.getContentUrl();return c.substring(c.indexOf(b)+b.length,c.length)},getUrl:function(){return a.getContentUrl()},getLeafNodes:function(){return m},getSequenceNodes:function(){return l},
getRootNode:function(){return q},getUnattached:function(a){for(var b=[],a=a=="node"?m:l,c=0;c<a.length;c++)a[c]&&!D(a[c].id)&&q!=a[c]&&b.push(a[c]);return b},getNodeFilename:function(a){return(a=o(a))?a.content.getFilename(b):null},generateUniqueTitle:function(a){var b;a:for(var c=1;;){var d=a+" "+c;if(!H(d)){b=d;break a}c++}return b},generateUniqueId:function(a){var b;a:for(var c=1;;){var d=a+"_"+c;if(!o(d)&&E.indexOf(d)==-1){b=d;break a}c++}return b},generateUniqueCopyEventName:function(){return d.eventManager.generateUniqueEventName("copy_")},
addCopyId:function(a){E.push(a)},projectJSON:function(){var a={autoStep:s,stepLevelNum:v,stepTerm:y,title:t,constraints:u,nodes:[],sequences:[],startPoint:""};if(q)a.startPoint=q.id;for(var c=0;c<m.length;c++)a.nodes.push(m[c].nodeJSON(b));for(c=0;c<l.length;c++)l[c]&&a.sequences.push(l[c].nodeJSON());return a},makeUrl:function(a,b){return G(a,b)},getNodePromptByNodeId:function(a){return o(a).getPrompt()},setPostLevel:function(a){F=a},getPostLevel:function(){return F},getVLEPositionById:function(a){return x(a)},
getDuplicatesOf:function(a,b){var c=[],d=o(a);if(d!=null){d.type=="DuplicateNode"&&(d=d.getNode());b&&c.push(d);for(var e=0;e<m.length;e++)m[e].type=="DuplicateNode"&&m[e].getNode().id==d.id&&c.push(m[e])}return c},getNextReviewGroupNumber:function(){for(var b=null,c=a.getContentJSON().nodes,d=[],e=0;e<c.length;e++){var k=o(c[e].identifier).reviewGroup;k&&d.indexOf(k)==-1&&d.push(k)}for(c=1;c<1E3;c++)if(d.indexOf(c)==-1){b=c;break}return b},cancelReviewSequenceGroup:function(b){for(var c=a.getContentJSON().nodes,
d=0;d<c.length;d++){var e=o(c[d].identifier);if(e){var k=e.reviewGroup;if(k&&k==b)e.peerReview=null,e.teacherReview=null,e.reviewGroup=null,e.associatedStartNode=null,e.associatedAnnotateNode=null}}eventManager.fire("saveProject")},getPreviousAndNextNodeIds:function(a){for(var b=N("HtmlNode:OutsideUrlNode"),c={},d=0;d<b.length;d++)if(b[d]==a){c.previousNodeId=b[d-1];if(c.previousNodeId)c.previousNodePosition=x(c.previousNodeId);c.nextNodeId=b[d+1];if(c.nextNodeId)c.nextNodePosition=x(c.nextNodeId);
break}return c},positionBeforeOrEqual:function(a,b){var c;a:{c=a.split(".");for(var d=b.split("."),e=0;e<d.length;e++)if(e>c.length-1)break;else{var f=parseInt(c[e]),k=parseInt(d[e]);if(f>k){c=!1;break a}else if(f<k)break}c=!0}return c},positionAfter:function(a,b){var c;a:{c=a.split(".");for(var d=b.split("."),e=0;e<c.length;e++)if(!(e>d.length-1)){var f=parseInt(c[e]),k=parseInt(d[e]);if(f>k){c=!0;break a}else if(f<k){c=!1;break a}}c=!1}return c},getNodesInReviewSequenceGroup:function(b){var c=[];
if(b)for(var d=a.getContentJSON().nodes,e=0;e<d.length;e++){var k=d[e],g=o(k.identifier);g&&g.reviewGroup==b&&c.push(k)}return c},getReviewSequencePhaseByNodeId:function(a){var b="";if(a=o(a))if(a.peerReview)b=a.peerReview;else if(a.teacherReview)b=a.teacherReview;return b},getDescendentNodeIds:function(a,b){return P(a,b)},getConstraints:function(){return u},addConstraint:function(a){u.push(a)},removeConstraint:function(a){for(var b=0;b<u.length;b++)if(u[b].id==a){u.splice(b,1);break}},containsConstraintNodes:function(){var a;
a:{for(a=0;a<m.length;a++)if(m[a].getType()=="AssessmentListNode"||m[a].getType()=="ChallengeNode"||m[a].getType=="BranchNode"){a=!0;break a}a=!1}return a},containsProjectConstraints:function(){return u.length>0},hasNewFeedback:function(){return ca()},getStepNumberAndTitle:function(a){var b="",c=x(a);b+=c+": ";a=o(a);a!=null&&(b+=a.title);return b}}}(a,b,c,d,e)}typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/project/Project.js");function createAttribute(a,b,c,d){a=a.createAttribute(c);a.nodeValue=d;b.setAttributeNode(a)}function createElement(a,b,c){b=a.createElement(b);if(c!=null)for(var d in c)createAttribute(a,b,d,c[d]);return b}function createBreak(){return createElement(document,"br",null)}function createSpace(){return document.createTextNode(" ")}function encodeString(a){return encodeURIComponent(a)}
function getElementsByAttribute(a,b,c){c=c?window.frames.ifrm.document.frames[c].document:window.frames.ifrm.document;if(b!=null)return $(c).filter("["+a+"="+b+"]");else if(c)return $(c).filter("["+a+"]")}function checkAccessibility(a){$.ajax({type:"HEAD",url:a,success:function(){return!0},error:function(){return!1}})}function normalizeHTML(a){return a.replace(/\s+/g,"")}if(!Array.contains)Array.prototype.contains=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return!0;return!1};
if(!Array.indexOf)Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1};if(!Array.map)Array.prototype.map=function(a){for(var b=[],c=0;c<this.length;c++)b.push(a(this[c]));return b};if(!Array.compare)Array.prototype.compare=function(a){if(this.length!=a.length)return!1;for(var b=0;b<a.length;b++){if(this[b].compare&&!this[b].compare(a[b]))return!1;if(this[b]!==a[b])return!1}return!0};
function hideElement(a){document.getElementById(a).style.display="none"}function showElement(a){document.getElementById(a).style.display="block"}function findPos(a){var b=curtop=0;if(a.offsetParent){do b+=a.offsetLeft,curtop+=a.offsetTop;while(a=a.offsetParent)}return{left:b,top:curtop}}function objSize(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}
function loadXMLDocFromString(a){try{return xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async="false",xmlDoc.loadXML(a),xmlDoc}catch(b){try{return parser=new DOMParser,xmlDoc=parser.parseFromString(a,"text/xml")}catch(c){alert(c.message)}}return null}typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/common/helperfunctions.js");View.prototype.loadProject=function(a,b,c){var d=function(d,f,g){f=createContent();f.setContent(d);g.projectMetadata=f.getContentJSON();if(g.projectMetadata){d=g.projectMetadata.maxScores;if(d==null||d=="")d="[]";g.processMaxScoresJSON(d);d=g.projectMetadata.lastEdited;f=g.projectMetadata.lastMinified;if(d&&f&&d<f&&!(g.name=="authoring"||g.name=="vle")){eventManager.fire("loadingProjectStart");try{g.project=createProject(createContent(a),b,c,g,createContent(a.replace(/\.project(.*)\.json/,".project-min$1.json")))}catch(m){g.project=
createProject(createContent(a),b,c,g)}g.isLoadedProjectMinified=!0}else eventManager.fire("loadingProjectStart"),g.project=createProject(createContent(a),b,c,g),g.isLoadedProjectMinified=!1,$("#currentProjectContainer").show(),$("#authoringContainer").show();eventManager.fire("loadingProjectComplete")}else e(d,g)},e=function(d,e){e.eventManager.fire("loadingProjectStart");e.project=createProject(createContent(a),b,c,e);e.isLoadedProjectMinified=!1;e.eventManager.fire("loadingProjectComplete")};if(this.projectMetaData==
null){var f=this.getConfig().getConfigParam("projectMetaDataUrl");if(f){var g={command:"getProjectMetaData",projectId:this.getProjectId()};this.connectionManager.request("GET",1,f,g,d,this,e)}else this.eventManager.fire("loadingProjectStart"),this.project=createProject(createContent(a),b,c,this),this.isLoadedProjectMinified=!1,this.eventManager.fire("loadingProjectComplete")}};View.prototype.getProject=function(){return this.project};
View.prototype.injectVleUrl=function(a){var b=window.location.toString(),b=b.substring(0,b.indexOf("/vle/"))+"/vle/";return a=a.replace(/(src='|src="|href='|href=")(?!http|\/)/gi,"$1"+b)};View.prototype.getHTMLContentTemplate=function(a){return a.getHTMLContentTemplate()};typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/view/coreview.js");View.prototype.utils={};View.prototype.utilDispatcher=function(a,b,c){a=="loadConfigComplete"?c.initializeSession():a=="maintainConnection"?c.sessionManager.maintainConnection():a=="renewSession"?c.connectionManager.request("GET",2,c.config.getConfigParam("indexUrl"),{},null,c):a=="checkSession"?c.sessionManager.checkSession():a=="forceLogout"&&c.forceLogout()};View.prototype.getMaxScoresSum=function(a){return this.maxScores==null?0:this.maxScores.getMaxScoresSum(a)};
View.prototype.getProjectMetaData=function(){var a=this.getConfig().getConfigParam("projectMetaDataUrl");if(a&&a!=""){var b={command:"getProjectMetaData",projectId:this.getConfig().getConfigParam("projectId")};this.connectionManager.request("GET",1,a,b,function(a,b,e){b=e[0];if(a!=null&&a!=""){b.projectMetadata=b.$.parseJSON(a);a=b.projectMetadata.maxScores;if(a==null||a=="")a="[]";b.processMaxScoresJSON(a)}b.projectMetaDataRetrieved=!0;eventManager.fire("getProjectMetaDataComplete")},[this],function(a,
b){b[0].projectMetaDataRetrieved=!0;eventManager.fire("getProjectMetaDataComplete")})}};View.prototype.getRunExtras=function(){this.connectionManager.request("GET",1,this.getConfig().getConfigParam("getRunExtrasUrl"),null,function(a,b,c){b=c[0];a!=null&&a!=""&&b.processMaxScoresJSON(a);b.runExtrasRetrieved=!0;eventManager.fire("getRunExtrasComplete")},[this],function(a,b){b[0].runExtrasRetrieved=!0;eventManager.fire("getRunExtrasComplete")})};
View.prototype.processMaxScoresJSON=function(a){a=MaxScores.prototype.parseMaxScoresJSONString(a);this.maxScores==null?this.maxScores=a:this.maxScores.mergeMaxScores(a)};View.prototype.utils.containsApplet=function(a){a=a.getContentString();return a.indexOf("<applet")!=-1&&a.indexOf("</applet>")!=-1?!0:!1};View.prototype.utils.appropriateSizeText=function(a){return a>1048576?this.roundToDecimal(a/1024/1024,1)+" mb":a>1024?this.roundToDecimal(a/1024,1)+" kb":a+" b"};
View.prototype.utils.roundToDecimal=function(a,b){var c=1;b&&(c=Math.pow(10,b));return Math.round(a*c)/c};View.prototype.utils.insertAppletParam=function(a,b,c){var d=a.getContentString(),b='<param name="'+b+'" value="'+c+'">';d.indexOf(b)==-1&&a.setContent(d.replace("</applet>",b+"\n</applet>"))};View.prototype.utils.getContentPath=function(a,b){return b.substring(b.indexOf(a)+a.length,b.length)};
View.prototype.utils.getSelectedValueById=function(a){if(a=document.getElementById(a))if(a=a.options[a.selectedIndex])return a.value;return""};View.prototype.utils.setSelectedValueById=function(a,b){var c=document.getElementById(a);if(c&&b)for(var d=0;d<c.options.length;d++)if(c.options[d].value==b)c.selectedIndex=d};View.prototype.utils.resolveNullToEmptyString=function(a){return a==null||a=="null"?"":a};
View.prototype.getElementsByClassName=function(a,b,c){var d=[];a==null&&(a=document);c==null&&(c="*");a=a.getElementsByTagName(c);c=a.length;b=RegExp("\\b"+b+"\\b");for(j=i=0;i<c;i++)b.test(a[i].className)&&(d[j]=a[i],j++);return d};View.prototype.getLatestStateForNode=function(a){var b=null;if(this.state!=null)for(var c=this.state.visitedNodes.length-1;c>=0;c--){var d=this.state.visitedNodes[c];if(d.getNodeId()==a)for(var e=d.nodeStates.length-1;e>=0;)return b=d.nodeStates[e]}return b};
View.prototype.isLatestNodeStateLocked=function(a){a=this.getLatestStateForNode(a);return a!=null&&a.locked!=null?a.locked:!1};View.prototype.getLatestStateForCurrentNode=function(){var a=this.getCurrentNode();if(!(a.type!="HtmlNode"&&a.type!="MySystemNode"&&a.type!="SVGDrawNode"&&a.type!="MWNode")){var b="";if(this.state!=null)for(var a=this.state.getNodeVisitsByNodeId(a.id),c=0;c<a.length;c++){var d=a[c].nodeStates;if(d!=null)for(var e=0;e<d.length;e++)if(d[e].data!="")b=d[e].data}return b}};
View.prototype.saveMaxScore=function(a,b){var c=document.getElementById("maxScore_"+b).value,d=parseInt(c);isNaN(d)||d<0?(alert("Error: invalid Max Score value, please enter a value 0 or greater"),document.getElementById("maxScore_"+b).value=this.getMaxScoreValueByNodeId(b)):(c={command:"postMaxScore",projectId:this.getProjectId(),nodeId:b,maxScoreValue:c},this.connectionManager.request("POST",1,this.getConfig().getConfigParam("projectMetaDataUrl"),c,function(a,b,c){var b=c[0],d=null;try{d=$.parseJSON(a)}catch(p){}d==
null?a=="ERROR:LoginRequired"?(alert("Your latest grade has not been saved.\n\nYou have been inactive for too long and have been logged out. Please log back in to continue."),parent.window.location="/webapp/j_spring_security_logout"):(a=c[1],b.revertMaxScore(a)):(a=d.nodeId,b.updateMaxScore(a,d.maxScoreValue))},[this,b],function(a,b){b[0].revertMaxScore(b[1])}))};
View.prototype.revertMaxScore=function(a){alert("Failed to save max score, the max score will be reverted back to its previous value.");document.getElementById("maxScore_"+a).value=this.getMaxScoreValueByNodeId(a)};View.prototype.getMaxScoreValueByNodeId=function(a){var b="0";this.maxScores!=null&&(b=this.maxScores.getMaxScoreValueByNodeId(a)+"");return b};View.prototype.updateMaxScore=function(a,b){if(this.maxScores==null)this.maxScores=new MaxScores;this.maxScores.updateMaxScore(a,b)};
View.prototype.getProjectId=function(){var a="",a=this.portalProjectId!=null?this.portalProjectId:this.getConfig().getConfigParam("projectId");a!=null&&a!=""&&(a=parseInt(a));return a};View.prototype.replaceSlashNWithDiv=function(a){a!=null&&(a=a.constructor.toString().indexOf("Array")==-1?a.replace(/\n/g,"</div><div>"):a[0].replace(/\n/g,"</div><div>"),a=("<div>"+a).replace(/<div>$/,""));return a};
View.prototype.forceLogout=function(){alert("You have been inactive for too long and have been logged out. Please log back in to continue.");parent.window.location="/webapp/j_spring_security_logout"};View.prototype.getIdeaBasketByWorkgroupId=function(a){var b=null;if(this.getUserAndClassInfo().getWorkgroupId()==a)b=this.ideaBasket;else if(this.ideaBaskets!=null)for(var c=0;c<this.ideaBaskets.length;c++){var d=this.ideaBaskets[c];if(d.workgroupId==a){b=d;break}}return b};
View.prototype.isSelfRenderingGradingViewNodeType=function(a){var b=!1;a!="HtmlNode"&&a!="BrainstormNode"&&a!="FillinNode"&&a!="MatchSequenceNode"&&a!="MultipleChoiceNode"&&a!="NoteNode"&&a!="JournalEntryNode"&&a!="OutsideUrlNode"&&a!="OpenResponseNode"&&a!="BlueJNode"&&a!="DrawNode"&&a!="DataGraphNode"&&a!="MySystemNode"&&a!="SVGDrawNode"&&a!="MWNode"&&a!="AssessmentListNode"&&a!="ChallengeNode"&&a!="BranchNode"&&(b=!0);return b};
View.prototype.getMaxScoreForProject=function(){var a=0,b=this.getProject().getNodeIds();this.maxScores!=null&&(a=this.maxScores.getMaxScoresSum(b));return a};View.prototype.utils.getExtension=function(a){var b=a.lastIndexOf(".");return b?a.substring(b+1,a.length):null};
View.prototype.assetUploaded=function(a){var b=a.target,c=window.frames[a.target.id];c.document&&c.document.body&&c.document.body.innerHTML!=""?(notificationManager.notify(c.document.body.innerHTML,3),b.src="about:blank",a.target.getAttribute("type")=="student"?eventManager.fire("viewStudentAssets"):eventManager.fire("viewAssets"),$("#assetProcessing").hide(),document.body.style.cursor="default",document.getElementById("uploadAssetFile").setAttribute("name","uploadAssetFile")):document.body.removeChild(b)};
View.prototype.initializeSession=function(){this.sessionManager=new SessionManager(eventManager,this)};View.prototype.utils.fileFilter=function(a,b){return a.indexOf(this.getExtension(b).toLowerCase())!=-1};View.prototype.startXMPP=function(){this.xmpp=WISE.init(this)};
View.prototype.checkXMPPEnabled=function(){this.isXMPPEnabled=!1;if(this.config.getConfigParam("isXMPPEnabled")!=null&&this.config.getConfigParam("isXMPPEnabled")){var a=this.config.getConfigParam("runInfo");if(a!=null&&a!=""&&(a=JSON.parse(a),a!=null&&a.isXMPPEnabled!=null))this.isXMPPEnabled=a.isXMPPEnabled}};typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/view/view_utils.js");View.prototype.i18n={locales:[]};View.prototype.getI18NString=function(a){return this.i18n.getString(a,this.config.getConfigParam("locale"))};View.prototype.getStringWithParams=function(a,b){return this.i18n.getStringWithParams(a,this.config.getConfigParam("locale"),b)};View.prototype.i18n.defaultLocale="en_US";View.prototype.i18n.supportedLocales=["en_US","ja","zh_TW"];
View.prototype.i18n.getString=function(a,b){if(View.prototype.i18n.supportedLocales.indexOf(b)==-1)b=View.prototype.i18n.defaultLocale;return this[b][a]!==void 0?this[b][a].value:this[View.prototype.i18n.defaultLocale][a].value};View.prototype.i18n.getStringWithParams=function(a,b,c){a=this.getString(a,b);for(b=0;b<c.length;b++)a=a.replace("{"+b+"}",c[b]);return a};
View.prototype.retrieveLocale=function(a){$.ajax({url:"view/i18n/i18n_"+a+".json",async:!1,success:function(b){View.prototype.i18n[a]=JSON.parse(b)},error:function(){}})};View.prototype.retrieveLocales=function(){this.retrieveLocale(View.prototype.i18n.defaultLocale);var a=this.config.getConfigParam("locale");if(a!=View.prototype.i18n.defaultLocale)for(var b=0;b<View.prototype.i18n.supportedLocales.length;b++){var c=View.prototype.i18n.supportedLocales[b];c==a&&(View.prototype.i18n[c]={},this.retrieveLocale(c))}eventManager.fire("retrieveLocalesComplete")};
typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/view/i18n/view_i18n.js");function ConnectionManager(a){this.em=a;this.MAX=5;this.queue=[];this.counter=this.running=0}ConnectionManager.prototype.request=function(a,b,c,d,e,f,g,k){if(a=="GET")a=new GetConnection(b,c,d,e,f,this.em,g,k);else if(a=="POST")a=new PostConnection(b,c,d,e,f,this.em,g,k);else{alert("unknown connection type: "+a+"\nExiting...");return}this.queue.push(a);this.launchNext()};
ConnectionManager.prototype.launchNext=function(){if(this.queue.length>0&&this.running<this.MAX){this.queue.sort(this.orderByPriority);var a=this.queue.shift(),b=this.generateEventName();this.em.addEvent(b);this.em.subscribe(b,function(a,b,e){e.running--;e.launchNext()},this);this.running++;a.startRequest(b)}};ConnectionManager.prototype.orderByPriority=function(a,b){if(a.priority<b.priority)return-1;if(a.priority>b.priority)return 1;if(a.priority==b.priority)return 0};
ConnectionManager.prototype.generateEventName=function(){for(;;){var a="connectionEnded"+this.counter;if(!this.em.isEvent(a))return a;this.counter++}};function Connection(a,b,c,d,e,f){this.em=f}Connection.prototype.startRequest=function(a){this.en=a;$.ajax({type:this.type,url:this.url,error:this.failure,success:this.success,dataType:"text",data:this.params,context:this,async:this.sync?!1:!0})};
Connection.prototype.parseConnectionArgs=function(){var a=!0;if(this.cArgs){this.params="";for(var b in this.cArgs)a?a=!1:this.params+="&",this.params+=b+"="+this.cArgs[b]}};
Connection.prototype.success=function(a,b,c){if(c.status==0)this.failure(c,b);else{this.em.fire(this.en);if(c.responseText!="undefined"&&c.responseText.match("login for portal")!=null){a="";try{this.hArgs!=null&&this.hArgs.length>0&&this.hArgs[0].getConfig()!=null&&(a=this.hArgs[0].getConfig().getConfigParam("mode"))}catch(d){}a=="grading"?(alert("You have been inactive for too long and have been logged out. Please log back in to continue."),parent.window.location="/webapp/j_spring_security_logout"):
(notificationManager?notificationManager.notify("You have been inactive for too long and have been logged out. Please log back in to continue.",3):alert("You have been inactive for too long and have been logged out. Please log back in to continue."),window.location="/webapp/j_spring_security_logout")}else this.handler&&this.handler(a,a,this.hArgs);this.em.fire("maintainConnection")}};
Connection.prototype.failure=function(a,b){this.em.fire(this.en);if(this.fHandler)this.fHandler(b,this.hArgs);else{var c="Connection request failed: TEXT="+b;notificationManager?notificationManager.notify(c,2):alert(c)}};GetConnection.prototype=new Connection;GetConnection.prototype.constructor=GetConnection;GetConnection.prototype.parent=Connection.prototype;
function GetConnection(a,b,c,d,e,f,g,k){this.type="GET";this.priority=a;this.em=f;this.url=b;this.cArgs=c;this.handler=d;this.hArgs=e;this.fHandler=g;this.params=null;this.sync=k;this.parseConnectionArgs()}PostConnection.prototype=new Connection;PostConnection.prototype.constructor=PostConnection;PostConnection.prototype.parent=Connection.prototype;
function PostConnection(a,b,c,d,e,f,g,k){this.type="POST";this.priority=a;this.em=f;this.url=b;this.cArgs=c;this.handler=d;this.hArgs=e;this.fHandler=g;this.params=null;this.sync=k;this.parseConnectionArgs()}typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/io/ConnectionManager.js");function SessionManager(a,b){this.em=a;this.view=b;this.sessionTimeoutInterval=12E5;if(b.config&&b.config.getConfigParam("sessionTimeoutInterval"))this.sessionTimeoutInterval=b.config.getConfigParam("sessionTimeoutInterval");this.sessionTimeoutCheckInterval=6E4;if(b.config&&b.config.getConfigParam("sessionTimeoutCheckInterval"))this.sessionTimeoutCheckInterval=b.config.getConfigParam("sessionTimeoutCheckInterval");this.sessionTimeoutWarning=this.sessionTimeoutInterval*0.75;this.lastSuccessfulRequest=
Date.parse(new Date);setInterval('eventManager.fire("checkSession")',this.sessionTimeoutCheckInterval)}SessionManager.prototype.maintainConnection=function(){this.lastSuccessfulRequest=Date.parse(new Date)};
SessionManager.prototype.checkSession=function(){if(this.view.config.getConfigParam("mode")!="portalpreview")if(this.view.gradingType!=null&&this.view.gradingType=="monitor")eventManager.fire("renewSession");else if(this.lastSuccessfulRequest!=null)Date.parse(new Date)-this.lastSuccessfulRequest>this.sessionTimeoutInterval?(notificationManager?notificationManager.notify("You have been inactive for too long and have been logged out. Please log back in to continue.",3):alert("You have been inactive for too long and have been logged out. Please log back in to continue."),
parent.window.location="/webapp/j_spring_security_logout"):Date.parse(new Date)-this.lastSuccessfulRequest>this.sessionTimeoutWarning&&($("#sessionMessageDiv").html("You have been inactive for a long time. If you do not renew your session now, you will be logged out of WISE."),$("#sessionMessageDiv").dialog({autoOpen:!0,draggable:!0,modal:!0,title:"Session Timeout",width:400,position:["center","top"],buttons:{"STAY LOGGED IN!":function(){eventManager.fire("renewSession");$("#sessionMessageDiv").dialog("close")}},
close:function(){eventManager.fire("renewSession")}}))};typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/session/SessionManager.js");var notificationManager={mode:null,count:0,debugMode:!1,levels:{1:"info",2:"warn",3:"alert",4:"log",5:"fatal"},latestMessages:[],notify:function(a,b,c){if(b)if(b=this.levels[b],this.debugMode)window.console?(b||(b="log"),b=="alert"&&(b="error"),window.console[b]("Notify debug: "+a)):this.notifyAlert("Notify debug: "+a,c);else{if(b)if(b=="alert")this.notifyAlert(a,c);else if(b=="fatal")eventManager.fire("fatalError",a);else if(b!="log"&&window.console&&window.console[b])window.console[b](a)}else this.notifyAlert(a,
c)},notifyAlert:function(a,b){new AlertObject(this.generateUniqueMessageDiv(b),a,this.mode)},generateUniqueMessageDiv:function(a){var b="";a&&(b=a);a="superSecretMessageDiv_"+this.count;return $("#"+a).size()!=0?(this.count++,generateUniqueMessageDiv()):($(".messages").each(function(){$(this).hasClass("keepMsg")||$(this).remove()}),$(".authoringMessages").each(function(){$(this).hasClass("keepMsg")||$(this).remove()}),this.mode&&this.mode=="authoring"?($("#notificationDiv").append('<div class="authoringMessages '+
b+'"><span id="'+a+'"><a title="Dismiss Message" onClick="notificationEventManager.fire(\'removeMsg\',\''+a+"')\">Dismiss</a></span></div>"),$("#notificationDiv").css("margin-top","0.1em")):$("body").append('<div id="'+a+'" class="messages '+b+'" style="display:none;" onClick="notificationEventManager.fire(\'removeMsg\',\''+a+"')\"></div>"),this.count++,a)},setMode:function(a){this.mode=a},alertClosing:void 0,viewLatest:void 0,closeNotifyWindow:void 0,init:function(a,b,c){alertClosing=a;viewLatest=
b;closeNotifyWindow=c;window.notificationEventManager=new EventManager;notificationEventManager.addEvent("removeMsg");notificationEventManager.addEvent("alertClosing");notificationEventManager.addEvent("viewLatest");notificationEventManager.addEvent("closeNotifyWindow");notificationEventManager.subscribe("alertClosing",this.alertClosing);notificationEventManager.subscribe("viewLatest",this.viewLatest);notificationEventManager.subscribe("closeNotifyWindow",this.closeNotifyWindow);a=createElement(document,
"div",{id:"mainMessageDiv","class":"minimessage"});document.body.appendChild(a);a.style.left=document.body.clientWidth/2-150;a.innerHTML='<div id="mainMessageMessage" onclick="notificationEventManager.fire(\'viewLatest\')">view last three notifications</div>'}(function(a,b){notificationManager.latestMessages.length<3||notificationManager.latestMessages.shift();notificationManager.latestMessages.push(b[0])},function(){var a=document.getElementById("mainMessageDiv");a.setAttribute("class","messages");
for(var b="Notify Messages: <br/><br>",c=0;c<notificationManager.latestMessages.length;c++)b+=notificationManager.latestMessages[c].substring(26,notificationManager.latestMessages[c].length)+"<br/><br/>";b+='<div id="mainMessageMessage" onclick="notificationEventManager.fire(\'closeNotifyWindow\')"><font color="blue">close</font></div>';a.innerHTML=b},function(){var a=document.getElementById("mainMessageDiv");a.setAttribute("class","minimessage");a.innerHTML='<div id="mainMessageMessage" onclick="notificationEventManager.fire(\'viewLatest\')">view last three notifications</div>'})};
function AlertObject(a,b,c){this.MSG_TIME=5E3;this.elId=a;this.msg=b;if(c)this.mode=c;notificationEventManager.subscribe("removeMsg",this.removeMsg,this);this.mode&&this.mode=="authoring"?(this.MSG_TIME=3E4,$("#"+a).prepend(b)):(b+='\n<p style="font-size:0.8em">(Click this message to remove it)</p>',$("#"+a).html(b),$("#"+a).css({display:"block",left:document.body.clientWidth/2-150,top:document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop}));eventManager.fire("browserResize");
$("#"+a).parent().hasClass("keepMsg")||setTimeout('notificationEventManager.fire("removeMsg","'+a+'")',this.MSG_TIME)}AlertObject.prototype.removeMsg=function(a,b,c){if(b[0]==c.elId)(a=c.mode)&&a=="authoring"?($("#"+c.elId).parent().remove(),$("#notificationDiv").css("margin-top",".25em")):$("#"+c.elId).remove(),eventManager.fire("browserResize"),notificationEventManager.fire("alertClosing",c.msg)};typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/util/NotificationManager.js");function createContent(a,b){return function(a,b){var e=b;e!=null&&e.charAt(e.length-1)!="/"&&(e+="/");var f,g,k,p=!1,r,m=function(a){return a=="xml"?g:a=="json"?k:a=="string"?f:null},l=function(b){r=setTimeout('eventManager.fire("contentTimedOut","'+a+'")',3E4);var d=new XMLHttpRequest;d.open("GET",a,!1);d.send(null);clearTimeout(r);if(d.responseText.match('content="login for portal"')!=null)eventManager.fire("forceLogout");else if(d.responseText||d.responseXML){d.responseXML?g=d.responseXML:s(d.responseText);
f=d.responseText?d.responseText:window.ActiveXObject?d.responseXML.xml:(new XMLSerializer).serializeToString(d.responseXML);e!=null&&(f=f.replace(RegExp('"./assets',"g"),'"'+e+"assets"),f=f.replace(RegExp('"/assets',"g"),'"'+e+"assets"),f=f.replace(RegExp('"assets',"g"),'"'+e+"assets"),f=f.replace(RegExp("'./assets","g"),"'"+e+"assets"),f=f.replace(RegExp("'/assets","g"),"'"+e+"assets"),f=f.replace(RegExp("'assets","g"),"'"+e+"assets"));try{k=$.parseJSON(f)}catch(l){k=void 0}p=!0;return m(b)}else return b=
"Error retrieving content for url: "+a,typeof eventManager!="undefined"?eventManager.fire("alert",b):alert(b),null},s=function(a){document.implementation&&document.implementation.createDocument?g=(new DOMParser).parseFromString(a,"text/xml"):window.ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLDOM"),g.loadXML(a));(window.ActiveXObject?g.xml.length!=0:g.getElementsByTagName("parsererror").length<1)||(g=void 0)};return{getContentXML:function(){return p?m("xml"):l("xml")},getContentJSON:function(){return p?
m("json"):l("json")},getContentString:function(){return p?m("string"):l("string")},setContent:function(a){if(typeof a=="string"){f=a;s(f);try{k=$.parseJSON(f)}catch(b){k=void 0}}else if(window.ActiveXObject)if(a.xml){g=a;f=a.xml;try{k=$.parseJSON(f)}catch(c){k=void 0}}else{k=a;try{f=$.stringify(k),s(f)}catch(d){k=void 0}}else if(a instanceof Document){g=a;f=(new XMLSerializer).serializeToString(g);try{k=$.parseJSON(f)}catch(e){k=void 0}}else{k=a;try{f=$.stringify(k),s(f)}catch(l){f=void 0}}p=!0},
retrieveContent:function(){p?m("string"):l("string")},getContentUrl:function(){return a},getFilename:function(b){return a.substring(a.indexOf(b)+b.length+1,a.length)}}}(a,b)}typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/content/content.js");function removeClassFromElement(a,b){$("#"+a).removeClass(b)}function addClassToElement(a,b){$("#"+a).addClass(b)}function hasClass(a,b){return $("#"+a).hasClass(b)}function clearFeedbackDiv(){document.getElementById("feedbackDiv").innerHTML=""}function clearResponseBox(){document.getElementById("responseBox").value=""}function setButtonVisible(a,b){document.getElementById(a).style.visibility=b?"visible":"hidden"}
function setCheckAnswerButtonEnabled(a){var b=document.getElementById("checkAnswerButton");a?b.removeAttribute("disabled"):b.setAttribute("disabled","true")}function setResponseBoxEnabled(a){var b=document.getElementById("responseBox");a?b.removeAttribute("disabled"):b.setAttribute("disabled","disabled")}function displayNumberAttempts(a,b,c){var c=c.length+1,d="",d=c==1?"1st":c==2?"2nd":c==3?"3rd":c+"th";document.getElementById("numberAttemptsDiv").innerHTML=a+" "+d+" "+b+"."}
function displayLastAttempt(a){if(a.length>0){var a=a[a.length-1].timestamp,b=a.getMonth()+1,c=a.getHours(),d=a.getMinutes(),e=a.getSeconds(),a=b+"/"+a.getDate()+"/"+a.getFullYear()+" at "+c+":"+d+":"+e;document.getElementById("lastAttemptDiv").innerHTML=" Your last attempt was on "+a}}function makeHtmlSafe(a){a&&typeof a=="string"&&(a=a.replace(/\&/g,"&amp;"),a=a.replace(/\"/g,"&quot;"));return a}typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/node/common/nodehelpers.js");function Annotation(a,b,c,d,e,f,g,k){this.runId=a;this.nodeId=b;this.toWorkgroup=c;this.fromWorkgroup=d;this.type=e;this.value=f;this.postTime=g;this.stepWorkId=k}Annotation.prototype.parseDataJSONString=function(a){a=$.parseJSON(a);return Annotation.prototype.parseDataJSONObj(a)};
Annotation.prototype.parseDataJSONObj=function(a){var b=new Annotation;b.runId=a.runId;b.nodeId=a.nodeId;b.toWorkgroup=a.toWorkgroup;b.fromWorkgroup=a.fromWorkgroup;b.type=a.type;b.value=a.value;b.postTime=a.postTime;b.stepWorkId=a.stepWorkId;if(a.data)b.data=NODE_VISIT.prototype.parseDataJSONObj(a.data);if(a.annotationComment)b.annotationComment=Annotation.prototype.parseDataJSONObj(a.annotationComment);return b};typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/grading/Annotation.js");function Annotations(){this.annotationsArray=[]}Annotations.prototype.addAnnotation=function(a){this.annotationsArray.push(a)};Annotations.prototype.updateOrAddAnnotation=function(a){for(var b=!1,c=0;c<this.annotationsArray.length;c++){var d=this.annotationsArray[c];if(d.runId==a.runId&&d.nodeId==a.nodeId&&d.toWorkgroup==a.toWorkgroup&&d.fromWorkgroup==a.fromWorkgroup&&d.type==a.type){this.annotationsArray.splice(c,1);this.addAnnotation(a);b=!0;break}}b||this.addAnnotation(a)};
Annotations.prototype.removeAnnotation=function(a,b,c,d,e){for(var f=0;f<this.annotationsArray.length;f++){var g=this.annotationsArray[f];g.runId==a&&g.nodeId==b&&g.toWorkgroup==c&&g.fromWorkgroup==d&&g.studentWork==e&&this.annotationsArray.splice(f,1)}};Annotations.prototype.removeFlagAnnotation=function(a,b,c,d){for(var e=0;e<this.annotationsArray.length;e++){var f=this.annotationsArray[e];f.runId==a&&f.nodeId==b&&f.toWorkgroup==c&&f.fromWorkgroup==d&&this.annotationsArray.splice(e,1)}};
Annotations.prototype.parseDataJSONString=function(a){a=$.parseJSON(a);return Annotations.prototype.parseDataJSONObj(a)};Annotations.prototype.parseDataJSONObj=function(a){var b=new Annotations;b.annotationsArray=[];if(a.annotationsArray!=null)for(var c=0;c<a.annotationsArray.length;c++){var d=Annotation.prototype.parseDataJSONObj(a.annotationsArray[c]);b.annotationsArray.push(d)}return b};
Annotations.prototype.getLatestAnnotationForNodeId=function(a){for(var b=null,c=0;c<this.annotationsArray.length;c++)tempAnnotation=this.annotationsArray[c],tempAnnotation.nodeId==a&&(b=tempAnnotation);return b};Annotations.prototype.getAnnotationsByNodeId=function(a){for(var b=[],c=0;c<this.annotationsArray.length;c++){var d=this.annotationsArray[c];d.nodeId==a&&b.push(d)}return b};
Annotations.prototype.getAnnotationsByToWorkgroup=function(a){for(var b=[],c=0;c<this.annotationsArray.length;c++){var d=this.annotationsArray[c];d.toWorkgroup==a&&b.push(d)}return b};Annotations.prototype.getAnnotationsByToWorkgroupAndFromWorkgroups=function(a,b){for(var c=[],d=0;d<this.annotationsArray.length;d++){var e=this.annotationsArray[d];e.toWorkgroup==a&&b.indexOf(parseInt(e.fromWorkgroup))!=-1&&c.push(e)}return c};
Annotations.prototype.getTotalScoreByToWorkgroup=function(a){for(var a=this.getAnnotationsByToWorkgroup(a),b=0,c=0;c<a.length;c++)a[c].type=="score"&&(b+=parseFloat(a[c].value));return b};Annotations.prototype.getTotalScoreByToWorkgroupAndFromWorkgroups=function(a,b){return this.getTotalScoreAndTotalPossibleByToWorkgroupAndFromWorkgroups(a,b,null).totalScore};
Annotations.prototype.getTotalScoreAndTotalPossibleByToWorkgroupAndFromWorkgroups=function(a,b,c){for(var d={},e=this.getAnnotationsByToWorkgroupAndFromWorkgroups(a,b),b=a=0,f={},g=[],k=0;k<e.length;k++){var p=e[k];if(e[k].type=="score"){var r=e[k].nodeId,m=f[r];m?m.postTime<p.postTime&&(f[r]=p):(f[r]=p,g.push(r))}}for(e=0;e<g.length;e++)k=g[e],p=f[k],p!=null&&p.value!=null&&p.value!=""&&!isNaN(p.value)&&(a+=parseFloat(p.value),c!=null&&(b+=parseFloat(c.getMaxScoreValueByNodeId(k))));d.totalScore=
a;d.totalPossible=b;return d};Annotations.prototype.getAnnotationsByNodeIdAndToWorkgroup=function(a,b){for(var c=[],d=0;d<this.annotationsArray.length;d++){var e=this.annotationsArray[d];e.nodeId==a&&e.toWorkgroup==b&&c.push(e)}return c};
Annotations.prototype.getLatestAnnotation=function(a,b,c,d,e,f){for(var g=null,k=0;k<this.annotationsArray.length;k++){var p=this.annotationsArray[k];if(p.runId==a&&p.nodeId==b&&p.toWorkgroup==c&&d.indexOf(parseInt(p.fromWorkgroup))!=-1&&p.type==e&&(f==null||f!=null&&p.stepWorkId==f))g?g.postTime<p.postTime&&(g=p):g=p}return g};Annotations.prototype.getAnnotationsByFromWorkgroup=function(a){for(var b=[],c=0;c<this.annotationsArray.length;c++){var d=this.annotationsArray[c];d.fromWorkgroup==a&&b.push(d)}return b};
Annotations.prototype.getAnnotationsByType=function(a){for(var b=[],c=0;c<this.annotationsArray.length;c++){var d=this.annotationsArray[c];d.type==a&&b.push(d)}return b};Annotations.prototype.getLatestAnnotationByAll=function(a,b,c,d,e){for(var f=null,g=this.annotationsArray.length-1;g>=0;g--)if(f=this.annotationsArray[g],f.runId==a&&f.nodeId==b&&f.toWorkgroup==c&&f.fromWorkgroup==d&&f.type==e)break;return f};
Annotations.prototype.getAnnotationByStepWorkIdType=function(a,b){for(var c=null,d=this.annotationsArray.length-1;d>=0;d--)if(c=this.annotationsArray[d],c.stepWorkId==a&&c.type==b)return c;return null};Annotations.prototype.annotationsAfterDate=function(a){for(var b=this.annotationsArray.length-1;b>=0;b--){var c=this.annotationsArray[b];if(c!=null&&c.type!="flag"&&c.postTime>a)return!0}return!1};
Annotations.prototype.getNodeIds=function(){for(var a=[],b=0;b<this.annotationsArray.length;b++){var c=this.annotationsArray[b];if(c!=null)c=c.nodeId,a.indexOf(c)==-1&&a.push(c)}return a};typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/grading/Annotations.js");function NODE_VISIT(a,b,c,d,e){this.nodeId=a;this.nodeType=b;this.visitPostTime=null;this.hintStates=[];arguments.length==2?(this.nodeStates=[],this.visitStartTime=Date.parse(new Date),this.visitEndTime=null):(this.nodeStates=c,this.visitStartTime=d,this.visitEndTime=e)}NODE_VISIT.prototype.getNodeId=function(){return this.nodeId};
NODE_VISIT.prototype.parseDataJSONObj=function(a,b){var c=new NODE_VISIT;c.id=a.stepWorkId;c.nodeId=a.nodeId;c.nodeType=a.nodeType;c.visitStartTime=a.visitStartTime;c.visitEndTime=a.visitEndTime;c.visitPostTime=a.visitPostTime;c.duplicateId=a.duplicateId;var d=null,d=typeof env=="undefined"?b.getProject().getNodeById(c.nodeId):env.getProject().getNodeById(c.nodeId);if(!d||d==null)return null;var e=[];if(a.nodeStates!=null)for(var f=0;f<a.nodeStates.length;f++){var g=a.nodeStates[f];g!=null&&(g=d.parseDataJSONObj(g),
e.push(g))}c.nodeStates=e;return c};NODE_VISIT.prototype.getLatestState=function(){return this.nodeStates[this.nodeStates.length-1]};NODE_VISIT.prototype.getLatestWork=function(){for(var a=this.nodeStates.length-1;a>=0;a--)if(this.nodeStates[a]!=null&&this.nodeStates[a].getStudentWork()!=null&&this.nodeStates[a].getStudentWork()!="")return this.nodeStates[a].getStudentWork();return""};typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/data/nodevisit.js");function HINTSTATE(a,b){this.type="hint";this.data=a;this.timestamp=b==null?(new Date).getTime():b}HINTSTATE.prototype.parseDataJSONObj=function(a){var b=new HINTSTATE;b.data=a.data;b.timestamp=a.timestamp;return b};HINTSTATE.prototype.getStudentWork=function(){return this.data};typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/hint/hintstate.js");function StudentStatus(){this.maxAlertLevel=0;this.alertables=[]}StudentStatus.prototype.addAlertable=function(a){this.removeAlertable(a.nodeId);this.alertables.push(a);this.updateMaxAlertLevel()};StudentStatus.prototype.updateMaxAlertLevel=function(){for(var a=0,b=0;b<this.alertables.length;b++){var c=this.alertables[b].alertLevel;c>a&&(a=c)}this.maxAlertLevel=a};
StudentStatus.prototype.removeAlertable=function(a){for(var b=0;b<this.alertables.length;b++)this.alertables[b].nodeId==a&&(this.alertables.splice(b,1),b-=1)};function StudentAlertable(a,b,c,d,e,f,g,k){this.alertLevel=a;this.nodeId=b;this.type=c;this.value=d;this.stepNumberAndTitle=e;this.nodeType=f;this.readableText=g;this.timestamp=k}typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/data/StudentStatus.js");Node.prototype.utils=function(){};Node.prototype.utils.generateKey=function(a){this.CHARS=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9"];a||(a=10);for(var b="",c=0;c<a;c++)b+=this.CHARS[Math.floor(Math.random()*(this.CHARS.length-1))];return b};
typeof eventManager!="undefined"&&eventManager.fire("scriptLoaded","vle/node/NodeUtils.js");
if(typeof eventManager != 'undefined'){eventManager.fire('scriptLoaded', 'vle/minified/core_min.js');}
